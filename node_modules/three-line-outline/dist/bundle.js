!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):"object"==typeof exports?exports.ThickLine=e(require("three")):r.ThickLine=e(r.THREE)}(self,(function(r){return(()=>{"use strict";var e={572:r=>{r.exports="uniform vec3 uColor;\r\nvarying vec4 vDebug;\r\n\r\nvoid main(){\r\n  gl_FragColor = vec4(uColor,1.);\r\n}"},30:r=>{r.exports="attribute vec3 aN0;\r\nattribute vec3 aN1;\r\nattribute vec4 aOtherVert;\r\nuniform float uAngleThresh;\r\nuniform int uOutline;\r\n\r\nvarying vec4 vDebug;\r\n\r\nvoid main() {\r\n\tvec4 mv = modelViewMatrix * vec4( position , 1. );\r\n\t\r\n\tgl_Position = projectionMatrix * mv;\r\n\tgl_Position.z -= 0.001; //wtf?\r\n\r\n\tvec3 viewDir = normalize(-mv.xyz);\r\n\t\r\n\t//check for null normals\r\n\tfloat l0 = length(aN0); \r\n\tfloat l1 = length(aN1);\r\n\r\n\tif(l0*l1 < 0.0001) return; //end of mesh\r\n\r\n\tfloat dd = dot(normalize(aN0),normalize(aN1));\r\n\r\n\tif(acos(dd) > uAngleThresh) return;\r\n\t\r\n\t//find point\r\n\tbool isOther = aOtherVert.w > 0.5;\r\n\tvec3 a;\r\n\tvec3 b;\r\n\r\n\tif(isOther){\r\n\t\ta = aOtherVert.xyz;\r\n\t\tb = position;\r\n\t} else {\r\n\t\ta = position;\r\n\t\tb = aOtherVert.xyz;\r\n\t}\r\n\r\n\tvec3 ld = normalize(b - a);\r\n\tvec3 camToEdge = cameraPosition - a;\r\n\tfloat f = dot(camToEdge,ld);\r\n\tvec3 p = a + ld * f;\r\n\tp = normalize(p-cameraPosition);\r\n\r\n\tvec3 vp =  ( modelViewMatrix * vec4(p,   0.) ).xyz;\r\n\tvec3 vN0 = ( modelViewMatrix * vec4(aN0, 0.) ).xyz;\r\n\tvec3 vN1 = ( modelViewMatrix * vec4(aN1, 0.) ).xyz;\r\n\r\n\tvDebug.x = sign(dot(vN0,viewDir));\r\n\tvDebug.y = sign(dot(vN1,viewDir));\r\n\r\n\tbool outline = sign(dot(vN0,viewDir)) * sign(dot(vN1,viewDir)) < 0.;\r\n\t\r\n\tif(uOutline == 1 && outline) return;\r\n\r\n\tgl_Position.z = -2000.; //wtf?\r\n}"},815:e=>{e.exports=r}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(r,e)=>{for(var t in e)n.o(e,t)&&!n.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},n.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),n.r=r=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{OutlineMesh:()=>f});var r,e=n(815),t=n(30),i=n(572),a=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=(Math.PI,function(r){function n(n,o,a){void 0===n&&(n=0),void 0===o&&(o=!0),void 0===a&&(a="#ffffff");var u=r.call(this,{vertexShader:t,fragmentShader:i,uniforms:{uAngleThresh:{value:0},uOutline:{value:0},uColor:{value:new e.Color}}})||this;return u._angleThreshold=n,u.angleThreshold=n,u.outline=o,u.color.setStyle(a),u}return a(n,r),Object.defineProperty(n.prototype,"angleThreshold",{get:function(){return this._angleThreshold},set:function(r){this._angleThreshold=r,this.uniforms.uAngleThresh.value=r/180*Math.PI%Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outline",{get:function(){return Boolean(this.uniforms.uOutline.value)},set:function(r){this.uniforms.uOutline.value=Number(r)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this.uniforms.uColor.value},enumerable:!1,configurable:!0}),n}(e.ShaderMaterial)),c=function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),l=new e.Vector3,f=function(r){function t(t,n){void 0===n&&(n=new u);var o=r.call(this,new e.BufferGeometry,n)||this;return o._extractGeometry(t.geometry),o}return c(t,r),t.prototype._extractGeometry=function(r){var t=r.index?this._extractIndexed(r):this._extractSoup(r),n=t.vArray,o=t.n0Array,i=t.n1Array,a=t.otherVertArray,u=this.geometry;u.setAttribute("position",new e.BufferAttribute(new Float32Array(n),3)),u.setAttribute("aN0",new e.BufferAttribute(new Float32Array(o),3)),u.setAttribute("aN1",new e.BufferAttribute(new Float32Array(i),3)),u.setAttribute("aOtherVert",new e.BufferAttribute(new Float32Array(a),4))},t.prototype._extractIndexed=function(r){for(var t=this._weldIndexed(r.index,r.attributes.position),n=t.weldedIndices,o=t.weldedVertices,i=this._extractEdgesFromIndex(n,o),a=[],u=[],c=[],l=[],f=new e.BoxBufferGeometry(.1,.1,.1),s=new e.MeshBasicMaterial({color:"red"}),p=0;p<o.length/3;p++)new e.Mesh(f,s).position.fromArray(o,3*p);return i.forEach((function(r,e){var t=r.a,n=r.b,i=r.n0,f=r.n1,s=function(r,e,t){var n=3*r;u.push.apply(u,e.toArray()),c.push.apply(c,t.toArray());for(var i=0;i<3;i++)a.push(o[n+i])};s(t,i,f),s(n,i,f);for(var p=0;p<3;p++)l.push(o[3*n+p]);l.push(0);for(var v=0;v<3;v++)l.push(o[3*t+v]);l.push(1)})),{vArray:a,n0Array:u,n1Array:c,otherVertArray:l}},t.prototype._weldIndexed=function(r,e){for(var t={},n={},o=[],i=[],a=0,u=0;a<e.count;a++){var c=3*a,l=[e.array[c],e.array[c+1],e.array[c+2]].map((function(r){return Math.round(1e3*r)})).join(":");void 0===t[l]&&(t[l]=u++,o.push(e.array[c],e.array[c+1],e.array[c+2])),n[a]=t[l]}for(var f=0;f<r.count;f+=3)for(var s=0;s<3;s++){var p=r.array[f+s];i.push(n[p])}return{weldedVertices:o,weldedIndices:i}},t.prototype._extractEdgesFromIndex=function(r,t){for(var n=[],o=new e.Vector3,i=new e.Vector3,a=new e.Vector3,u=0;u<r.length;){var c=new e.Vector3;o.fromArray(t,3*r[u++]),i.fromArray(t,3*r[u++]),a.fromArray(t,3*r[u++]),c.crossVectors(i.sub(o),a.sub(o)),n.push(c.normalize())}var f={},s=[];for(u=0;u<r.length/3;u++)for(var p=3*u,v=0;v<3;v++){var y=(v+1)%3,d=r[p+v],h=r[p+y];f[d]||(f[d]={}),f[d][h]=u,s.push([d,h])}var b=[],m={};return s.forEach((function(r){var e=r[0],t=r[1];if(m[e]||(m[e]={}),m[t]||(m[t]={}),!m[e][t]){var o=f[e][t],i=f[t][e],a=void 0!==o&&void 0!==i,u=a?n[o]:l,c=a?n[i]:l;b.push({a:e,b:t,n0:u,n1:c}),m[e][t]=!0,m[t][e]=!0}})),b},t.prototype._extractSoup=function(r){for(var e=r.attributes.position.count,t=0;t<e;t++)r.attributes.position.array;return{vArray:[],n0Array:[],n1Array:[],otherVertArray:[]}},t}(e.LineSegments)})(),o})()}));
//# sourceMappingURL=bundle.js.map